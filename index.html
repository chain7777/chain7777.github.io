<!doctype html>
<html lang="sl">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Product Editor (Ime + Velikost + Cena)</title>
  <style>
    :root { --bg:#0b1020; --panel:#121a33; --text:#e9eeff; --muted:#aab3d6; --border:#263056; }
    * { box-sizing: border-box; }
    body{
      margin:0; font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif; color:var(--text);
      background: radial-gradient(1200px 600px at 20% 0%, #16235b 0%, var(--bg) 45%),
                  radial-gradient(900px 500px at 80% 20%, #4a1d6a 0%, var(--bg) 55%);
    }
    header{ padding:24px 18px; max-width:1100px; margin:0 auto; }
    header h1{ margin:0 0 6px; font-size:22px; }
    header p{ margin:0; color:var(--muted); }

    .wrap{ max-width:1100px; margin:0 auto; padding:0 18px 28px; }
    .grid{ display:grid; grid-template-columns: 360px 1fr; gap:16px; }
    @media (max-width: 900px){ .grid{ grid-template-columns:1fr; } }

    .card{
      background: color-mix(in srgb, var(--panel) 86%, transparent);
      border:1px solid var(--border);
      border-radius:16px;
      padding:14px;
      box-shadow:0 10px 35px rgba(0,0,0,.25);
      backdrop-filter: blur(8px);
    }

    label{ font-size:12px; color:var(--muted); }
    input, select, button, textarea{
      width:100%;
      border-radius:12px;
      border:1px solid var(--border);
      background:#0d1430;
      color:var(--text);
      padding:10px 12px;
      outline:none;
    }
    button{
      cursor:pointer;
      background: linear-gradient(180deg, rgba(255,255,255,.08), rgba(255,255,255,.02));
    }
    button:hover{ border-color:#3a4a84; }

    .row{ display:grid; gap:10px; }
    .btns{ display:grid; grid-template-columns:1fr 1fr; gap:10px; }
    .btns3{ display:grid; grid-template-columns:1fr 1fr 1fr; gap:10px; }
    hr{ border:none; border-top:1px solid var(--border); margin: 6px 0; }
    .warn{ font-size:12px; color:#ffd36e; }

    /* preview */
    .preview{ border-radius:18px; overflow:hidden; border:1px solid var(--border); min-height:320px; }
    .previewInner{ padding:18px; display:grid; gap:14px; }
    .chip{
      display:inline-flex; align-items:center; gap:8px;
      padding:7px 10px; border-radius:999px;
      border:1px solid rgba(255,255,255,.16);
      font-size:12px; color:rgba(255,255,255,.92);
      background: rgba(255,255,255,.06);
      width: fit-content;
    }

    /* “Produkt” kartica v preview */
    .productCard{
      border-radius:18px;
      border:1px solid rgba(255,255,255,.16);
      background: rgba(0,0,0,.16);
      padding:16px;
      display:grid;
      gap:10px;
      transform-origin: top left;
    }

    .namePreview{ margin:0; line-height:1.1; }
    .pricePreview{ margin:0; opacity:.92; }
    .meta{ font-size:12px; color: rgba(255,255,255,.75); }

    .footnote{ font-size:12px; color:var(--muted); margin-top:8px; }
    textarea{ min-height: 110px; font-family: ui-monospace, SFMono-Regular, Menlo, Consolas, monospace; }
  </style>
</head>
<body>
<header>
  <h1>Product Editor</h1>
  <p>5 produktov. Spreminjanje: <b>ime</b>, <b>velikost (mm)</b>, <b>cena (€)</b>. Večja velikost ⇒ večje črke v preview.</p>
</header>

<div class="wrap">
  <div class="grid">
    <section class="card">
      <div class="row">
        <div>
          <label>Produkt</label>
          <select id="productSelect"></select>
        </div>

        <div>
          <label>Ime produkta</label>
          <input id="nameInput" type="text" placeholder="npr. Moj Produkt" />
        </div>

        <div class="row" style="grid-template-columns: 1fr 1fr; gap:10px;">
          <div>
            <label>Velikost (mm)</label>
            <input id="sizeInput" type="number" min="10" step="1" />
          </div>
          <div>
            <label>Cena (€)</label>
            <input id="priceInput" type="number" min="0" step="0.01" />
          </div>
        </div>

        <div class="warn" id="warn"></div>

        <div class="btns">
          <button id="saveBtn">Shrani</button>
          <button id="resetBtn">Reset na privzeto</button>
        </div>

        <hr />

        <div class="row">
          <label>Izvoz / Uvoz JSON</label>
          <textarea id="jsonArea" placeholder='Klikni "Izvozi", ali prilepi JSON in klikni "Uvozi".'></textarea>
          <div class="btns3">
            <button id="exportBtn">Izvozi</button>
            <button id="importBtn">Uvozi</button>
            <button id="clearBtn">Počisti shrambo</button>
          </div>
          <div class="footnote" id="status"></div>
        </div>
      </div>
    </section>

    <section class="card preview" id="previewCard">
      <div class="previewInner">
        <span class="chip">● Live preview</span>

        <div id="productCard" class="productCard">
          <p class="meta" id="sizeMeta">Velikost: —</p>
          <h2 class="namePreview" id="previewName">—</h2>
          <p class="pricePreview" id="previewPrice">—</p>

          <div class="footnote">
            Ta “kartica” simulira produkt. Velikost vpliva na scale in font-size.
          </div>
        </div>

        <div class="footnote">Namig: klikni “Shrani” → ostane tudi po refreshu.</div>
      </div>
    </section>
  </div>
</div>

<script>
  const STORAGE_KEY = "product_editor_v3_name_size_price";

  const defaultProducts = [
    { id:"p1", name:"Produkt 1", sizeMm: 60,  priceEur: 9.99 },
    { id:"p2", name:"Produkt 2", sizeMm: 90,  priceEur: 14.50 },
    { id:"p3", name:"Produkt 3", sizeMm: 120, priceEur: 19.00 },
    { id:"p4", name:"Produkt 4", sizeMm: 150, priceEur: 24.90 },
    { id:"p5", name:"Produkt 5", sizeMm: 75,  priceEur: 11.20 },
  ];

  const els = {
    select: document.getElementById("productSelect"),
    name: document.getElementById("nameInput"),
    size: document.getElementById("sizeInput"),
    price: document.getElementById("priceInput"),
    warn: document.getElementById("warn"),
    save: document.getElementById("saveBtn"),
    reset: document.getElementById("resetBtn"),
    export: document.getElementById("exportBtn"),
    imp: document.getElementById("importBtn"),
    clear: document.getElementById("clearBtn"),
    json: document.getElementById("jsonArea"),
    status: document.getElementById("status"),
    previewCard: document.getElementById("previewCard"),
    productCard: document.getElementById("productCard"),
    sizeMeta: document.getElementById("sizeMeta"),
    previewName: document.getElementById("previewName"),
    previewPrice: document.getElementById("previewPrice"),
  };

  function clone(x){ return JSON.parse(JSON.stringify(x)); }

  function loadState(){
    try{
      const raw = localStorage.getItem(STORAGE_KEY);
      if(!raw) return clone(defaultProducts);
      const parsed = JSON.parse(raw);
      if(!Array.isArray(parsed) || parsed.length !== 5) return clone(defaultProducts);
      return parsed;
    } catch {
      return clone(defaultProducts);
    }
  }

  function saveState(products){
    localStorage.setItem(STORAGE_KEY, JSON.stringify(products, null, 2));
  }

  let products = loadState();
  let currentId = products[0]?.id;

  function setStatus(msg){ els.status.textContent = msg || ""; }

  function renderSelect(){
    els.select.innerHTML = "";
    for(const p of products){
      const opt = document.createElement("option");
      opt.value = p.id;
      opt.textContent = p.name;
      els.select.appendChild(opt);
    }
    els.select.value = currentId;
  }

  function getCurrent(){
    return products.find(p => p.id === currentId) || products[0];
  }

  function euro(n){
    const v = Number(n);
    if(!Number.isFinite(v)) return "—";
    return new Intl.NumberFormat("sl-SI", { style:"currency", currency:"EUR" }).format(v);
  }

  function validate(sizeMm, priceEur){
    const s = Number(sizeMm);
    const p = Number(priceEur);

    if(!Number.isFinite(s)) return "Velikost mora biti številka.";
    if(s < 10) return "Velikost naj bo vsaj 10 mm.";
    if(s > 500) return "Velikost je zelo velika (> 500 mm). Preveri vnos.";
    if(!Number.isFinite(p)) return "Cena mora biti številka.";
    if(p < 0) return "Cena ne more biti negativna.";
    if(p > 99999) return "Cena je previsoka (preveri vnos).";
    return "";
  }

  // scaling: 50mm -> 0.85, 200mm -> 1.35 (omejeno)
  function scaleFromSize(sizeMm){
    const s = Number(sizeMm);
    const t = (s - 50) / (200 - 50);
    const clamped = Math.max(0, Math.min(1, t));
    return 0.85 + clamped * (1.35 - 0.85);
  }

  // font sizing: 50mm -> 20px title, 200mm -> 34px title (omejeno)
  function titleFontFromSize(sizeMm){
    const s = Number(sizeMm);
    const t = (s - 50) / (200 - 50);
    const clamped = Math.max(0, Math.min(1, t));
    return 20 + clamped * (34 - 20);
  }

  function syncFormFromCurrent(){
    const p = getCurrent();
    if(!p) return;
    els.name.value = p.name;
    els.size.value = p.sizeMm;
    els.price.value = p.priceEur;
    els.warn.textContent = validate(els.size.value, els.price.value);
    renderPreview();
  }

  function updateCurrentFromForm(){
    const p = getCurrent();
    if(!p) return;
    p.name = els.name.value.trim() || "Brez imena";
    p.sizeMm = Number(els.size.value);
    p.priceEur = Number(els.price.value);
  }

  function renderPreview(){
    const p = getCurrent();
    if(!p) return;

    els.previewName.textContent = p.name;
    els.previewPrice.textContent = euro(p.priceEur);
    els.sizeMeta.textContent = `Velikost: ${p.sizeMm} mm`;

    const scale = scaleFromSize(p.sizeMm);
    const titlePx = titleFontFromSize(p.sizeMm);

    // apply scale + fonts
    els.productCard.style.transform = `scale(${scale})`;
    els.previewName.style.fontSize = `${titlePx}px`;
    els.previewPrice.style.fontSize = `${Math.round(titlePx * 0.65)}px`;

    // malo dinamičnega ozadja
    const t = Math.max(0, Math.min(1, (p.sizeMm - 50) / 150));
    const a = 0.18 + t * 0.18;
    const b = 0.08 + (1 - t) * 0.12;
    els.previewCard.style.background =
      `radial-gradient(900px 360px at 20% 10%, rgba(91,140,255,${a}) 0%, rgba(0,0,0,0) 55%),
       radial-gradient(800px 340px at 80% 35%, rgba(255,122,217,${b}) 0%, rgba(0,0,0,0) 55%),
       color-mix(in srgb, #121a33 86%, transparent)`;
  }

  // events
  els.select.addEventListener("change", () => {
    currentId = els.select.value;
    syncFormFromCurrent();
    setStatus("");
  });

  for(const input of [els.name, els.size, els.price]){
    input.addEventListener("input", () => {
      const w = validate(els.size.value, els.price.value);
      els.warn.textContent = w;

      if(!w){
        updateCurrentFromForm();
        renderSelect();
        els.select.value = currentId;
        renderPreview();
        setStatus("Spremembe niso shranjene.");
      } else {
        setStatus("Popravi vrednosti in potem shrani.");
      }
    });
  }

  els.save.addEventListener("click", () => {
    const w = validate(els.size.value, els.price.value);
    els.warn.textContent = w;
    if(w){ setStatus("Ne morem shraniti: popravi vrednosti."); return; }

    updateCurrentFromForm();
    saveState(products);
    renderSelect();
    els.select.value = currentId;
    setStatus("Shranjeno v localStorage ✅");
  });

  els.reset.addEventListener("click", () => {
    const def = defaultProducts.find(d => d.id === currentId);
    if(!def) return;
    const p = getCurrent();
    p.name = def.name;
    p.sizeMm = def.sizeMm;
    p.priceEur = def.priceEur;
    syncFormFromCurrent();
    saveState(products);
    renderSelect();
    els.select.value = currentId;
    setStatus("Reset narejen ✅");
  });

  els.export.addEventListener("click", () => {
    els.json.value = JSON.stringify(products, null, 2);
    setStatus("Izvoženo v tekst polje ✅");
  });

  els.imp.addEventListener("click", () => {
    try{
      const parsed = JSON.parse(els.json.value);
      if(!Array.isArray(parsed) || parsed.length !== 5) throw new Error("Mora biti 5 produktov.");
      for(const p of parsed){
        if(!p.id || !p.name) throw new Error("Manjka id/name.");
        if(!Number.isFinite(Number(p.sizeMm))) throw new Error("sizeMm ni številka.");
        if(!Number.isFinite(Number(p.priceEur))) throw new Error("priceEur ni številka.");
        const w = validate(p.sizeMm, p.priceEur);
        if(w) throw new Error(w);
      }
      products = parsed;
      currentId = products[0].id;
      saveState(products);
      renderSelect();
      syncFormFromCurrent();
      setStatus("Uvoženo in shranjeno ✅");
    } catch {
      setStatus("Napaka pri uvozu: preveri JSON (polja: id, name, sizeMm, priceEur).");
    }
  });

  els.clear.addEventListener("click", () => {
    localStorage.removeItem(STORAGE_KEY);
    products = clone(defaultProducts);
    currentId = products[0].id;
    renderSelect();
    syncFormFromCurrent();
    setStatus("Shramba pobrisana. Nazaj na privzeto ✅");
  });

  // init
  renderSelect();
  syncFormFromCurrent();
</script>
</body>
</html>
