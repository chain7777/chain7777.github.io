<!doctype html>
<html lang="sl">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Produkt konfigurator</title>
  <style>
    :root { --bg:#0b1020; --panel:#121a33; --text:#e9eeff; --muted:#aab3d6; --border:#263056; }
    * { box-sizing: border-box; }
    body{
      margin:0; font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif; color:var(--text);
      background: radial-gradient(1200px 600px at 20% 0%, #16235b 0%, var(--bg) 45%),
                  radial-gradient(900px 500px at 80% 20%, #4a1d6a 0%, var(--bg) 55%);
    }
    header{ padding:24px 18px; max-width:1100px; margin:0 auto; }
    header h1{ margin:0 0 6px; font-size:22px; }
    header p{ margin:0; color:var(--muted); }

    .wrap{ max-width:1100px; margin:0 auto; padding:0 18px 28px; }
    .grid{ display:grid; grid-template-columns: 360px 1fr; gap:16px; }
    @media (max-width: 900px){ .grid{ grid-template-columns:1fr; } }

    .card{
      background: color-mix(in srgb, var(--panel) 86%, transparent);
      border:1px solid var(--border);
      border-radius:16px;
      padding:14px;
      box-shadow:0 10px 35px rgba(0,0,0,.25);
      backdrop-filter: blur(8px);
    }

    label{ font-size:12px; color:var(--muted); }
    input, select, button, textarea{
      width:100%;
      border-radius:12px;
      border:1px solid var(--border);
      background:#0d1430;
      color:var(--text);
      padding:10px 12px;
      outline:none;
    }
    button{
      cursor:pointer;
      background: linear-gradient(180deg, rgba(255,255,255,.08), rgba(255,255,255,.02));
    }
    button:hover{ border-color:#3a4a84; }

    .row{ display:grid; gap:10px; }
    .btns{ display:grid; grid-template-columns:1fr 1fr; gap:10px; }
    .warn{ font-size:12px; color:#ffd36e; }
    .footnote{ font-size:12px; color:var(--muted); margin-top:8px; }
    textarea{ min-height: 110px; font-family: ui-monospace, SFMono-Regular, Menlo, Consolas, monospace; }

    /* PREVIEW */
    .preview{ border-radius:18px; overflow:hidden; border:1px solid var(--border); min-height:360px; }
    .previewInner{ padding:18px; display:grid; gap:14px; }
    .chip{
      display:inline-flex; align-items:center; gap:8px;
      padding:7px 10px; border-radius:999px;
      border:1px solid rgba(255,255,255,.16);
      font-size:12px; color:rgba(255,255,255,.92);
      background: rgba(255,255,255,.06);
      width: fit-content;
    }

    /* Okvir za produkt (da scale-amo celoto) */
    .productStage{
      width: 100%;
      display: grid;
      place-items: center;
      padding: 18px 0;
    }

    /* Ta element se SCALE-a glede na sizeMm */
    .productScaled{
      transform-origin: center;
      will-change: transform;
    }

    .productFigure{
      position: relative;
      width: 260px;           /* osnovna “normalna” velikost na strani */
      max-width: 70vw;
      aspect-ratio: 1 / 1;    /* pri večini je kvadrat; pri loparju bomo override */
      border-radius: 18px;
      overflow: hidden;
      background: rgba(0,0,0,.12);
      border: 1px solid rgba(255,255,255,.14);
    }

    /* Slika produkta */
    .productFigure img{
      width:100%;
      height:100%;
      object-fit: contain;
      display:block;
      background: #EAF2FF; /* pastelno ozadje */
    }

    /* Ime vedno v centru */
    .nameOverlay{
      position:absolute;
      inset:0;
      display:grid;
      place-items:center;
      pointer-events:none;
      text-align:center;
      padding: 14px;
      font-weight: 700;
      letter-spacing: 0.5px;
      color: #d13b3b; /* rdečkasta */
      text-shadow: 0 1px 0 rgba(255,255,255,.35);
      font-size: 28px; /* NORMALNA osnova — potem se poveča samo zato, ker se SCALE-a cel produkt */
      line-height: 1;
    }

    /* malo manjši font na telefonu */
    @media (max-width: 420px){
      .nameOverlay{ font-size: 24px; }
    }

    .metaRow{
      display:flex;
      gap:10px;
      flex-wrap: wrap;
      align-items:center;
      justify-content: space-between;
      border-top:1px solid rgba(255,255,255,.10);
      padding-top: 10px;
    }
    .metaPill{
      border:1px solid rgba(255,255,255,.16);
      background: rgba(255,255,255,.06);
      border-radius:999px;
      padding: 6px 10px;
      font-size:12px;
      color: rgba(255,255,255,.88);
    }
  </style>
</head>
<body>
<header>
  <h1>Konfigurator produkta</h1>
  <p>Ime je vedno v centru. Ob spremembi velikosti se poveča celoten produkt (slika + ime skupaj). Cena je nastavljiva.</p>
</header>

<div class="wrap">
  <div class="grid">
    <section class="card">
      <div class="row">
        <div>
          <label>Produkt</label>
          <select id="productSelect"></select>
        </div>

        <div>
          <label>Ime (stranka vpiše po želji)</label>
          <input id="nameInput" type="text" placeholder="npr. MARK" />
        </div>

        <div class="row" style="grid-template-columns: 1fr 1fr; gap:10px;">
          <div>
            <label>Velikost (mm)</label>
            <input id="sizeInput" type="number" min="30" step="1" />
          </div>
          <div>
            <label>Cena (€)</label>
            <input id="priceInput" type="number" min="0" step="0.01" />
          </div>
        </div>

        <div class="warn" id="warn"></div>

        <div class="btns">
          <button id="saveBtn">Shrani</button>
          <button id="resetBtn">Reset</button>
        </div>

        <div class="footnote" id="status"></div>
      </div>
    </section>

    <section class="card preview" id="previewCard">
      <div class="previewInner">
        <span class="chip">● Preview</span>

        <div class="productStage">
          <div id="productScaled" class="productScaled">
            <div id="productFigure" class="productFigure">
              <img id="productImg" alt="Produkt" />
              <div id="nameOverlay" class="nameOverlay">—</div>
            </div>
          </div>
        </div>

        <div class="metaRow">
          <span class="metaPill" id="metaSize">Velikost: —</span>
          <span class="metaPill" id="metaPrice">Cena: —</span>
        </div>

        <div class="footnote">Če slika ne pokaže: preveri, da so slike v mapi <b>/images</b> in da se imena ujemajo.</div>
      </div>
    </section>
  </div>
</div>

<script>
  const STORAGE_KEY = "product_editor_v4_images_center_text";

  // baseMm = “normalna” velikost, pri kateri je scale = 1
  const defaultProducts = [
    { id:"p1", label:"Oblak",  image:"images/p1.png", baseMm: 80,  name:"", sizeMm: 80,  priceEur: 9.99,  aspect:"1/1" },
    { id:"p2", label:"Žoga",   image:"images/p2.png", baseMm: 80,  name:"", sizeMm: 80,  priceEur: 12.99, aspect:"1/1" },
    { id:"p3", label:"Lopar",  image:"images/p3.png", baseMm: 120, name:"", sizeMm: 120, priceEur: 14.99, aspect:"3/4" },
    { id:"p4", label:"Produkt 4", image:"images/p4.png", baseMm: 80, name:"", sizeMm: 80, priceEur: 0.00, aspect:"1/1" },
    { id:"p5", label:"Produkt 5", image:"images/p5.png", baseMm: 80, name:"", sizeMm: 80, priceEur: 0.00, aspect:"1/1" },
  ];

  const els = {
    select: document.getElementById("productSelect"),
    name: document.getElementById("nameInput"),
    size: document.getElementById("sizeInput"),
    price: document.getElementById("priceInput"),
    warn: document.getElementById("warn"),
    save: document.getElementById("saveBtn"),
    reset: document.getElementById("resetBtn"),
    status: document.getElementById("status"),

    productScaled: document.getElementById("productScaled"),
    figure: document.getElementById("productFigure"),
    img: document.getElementById("productImg"),
    overlay: document.getElementById("nameOverlay"),
    metaSize: document.getElementById("metaSize"),
    metaPrice: document.getElementById("metaPrice"),
  };

  function clone(x){ return JSON.parse(JSON.stringify(x)); }

  function loadState(){
    try{
      const raw = localStorage.getItem(STORAGE_KEY);
      if(!raw) return clone(defaultProducts);
      const parsed = JSON.parse(raw);
      if(!Array.isArray(parsed) || parsed.length !== 5) return clone(defaultProducts);
      return parsed;
    } catch { return clone(defaultProducts); }
  }

  function saveState(products){
    localStorage.setItem(STORAGE_KEY, JSON.stringify(products, null, 2));
  }

  let products = loadState();
  let currentId = products[0]?.id;

  function euro(n){
    const v = Number(n);
    if(!Number.isFinite(v)) return "—";
    return new Intl.NumberFormat("sl-SI", { style:"currency", currency:"EUR" }).format(v);
  }

  function validate(sizeMm, priceEur){
    const s = Number(sizeMm);
    const p = Number(priceEur);
    if(!Number.isFinite(s)) return "Velikost mora biti številka.";
    if(s < 30) return "Velikost naj bo vsaj 30 mm.";
    if(s > 300) return "Velikost je zelo velika (> 300 mm).";
    if(!Number.isFinite(p)) return "Cena mora biti številka.";
    if(p < 0) return "Cena ne more biti negativna.";
    return "";
  }

  function renderSelect(){
    els.select.innerHTML = "";
    for(const p of products){
      const opt = document.createElement("option");
      opt.value = p.id;
      opt.textContent = p.label; // ime produkta v seznamu
      els.select.appendChild(opt);
    }
    els.select.value = currentId;
  }

  function getCurrent(){
    return products.find(p => p.id === currentId) || products[0];
  }

  function setStatus(msg){ els.status.textContent = msg || ""; }

  function syncFormFromCurrent(){
    const p = getCurrent();
    if(!p) return;
    els.name.value = p.name || "";
    els.size.value = p.sizeMm;
    els.price.value = p.priceEur;
    els.warn.textContent = validate(els.size.value, els.price.value);
    renderPreview();
  }

  function updateCurrentFromForm(){
    const p = getCurrent();
    if(!p) return;
    p.name = (els.name.value || "").trim();
    p.sizeMm = Number(els.size.value);
    p.priceEur = Number(els.price.value);
  }

  function renderPreview(){
    const p = getCurrent();
    if(!p) return;

    // slika
    els.img.src = p.image;

    // aspect ratio (lopar je bolj “pokončen”)
    els.figure.style.aspectRatio = p.aspect || "1/1";

    // ime v centru (če prazno, pokaži namig)
    els.overlay.textContent = p.name ? p.name : "VPIŠI IME";

    // SCALE celotnega produkta (slika + tekst)
    // scale = sizeMm / baseMm (omejimo, da ne razbije strani)
    const rawScale = p.sizeMm / (p.baseMm || 80);
    const scale = Math.max(0.7, Math.min(1.8, rawScale));
    els.productScaled.style.transform = `scale(${scale})`;

    els.metaSize.textContent = `Velikost: ${p.sizeMm} mm`;
    els.metaPrice.textContent = `Cena: ${euro(p.priceEur)}`;
  }

  // events
  els.select.addEventListener("change", () => {
    currentId = els.select.value;
    syncFormFromCurrent();
    setStatus("");
  });

  for(const input of [els.name, els.size, els.price]){
    input.addEventListener("input", () => {
      const w = validate(els.size.value, els.price.value);
      els.warn.textContent = w;

      if(!w){
        updateCurrentFromForm();
        renderPreview();
        setStatus("Spremembe niso shranjene.");
      } else {
        setStatus("Popravi vrednosti in potem shrani.");
      }
    });
  }

  els.save.addEventListener("click", () => {
    const w = validate(els.size.value, els.price.value);
    els.warn.textContent = w;
    if(w){ setStatus("Ne morem shraniti: popravi vrednosti."); return; }

    updateCurrentFromForm();
    saveState(products);
    setStatus("Shranjeno ✅");
  });

  els.reset.addEventListener("click", () => {
    const def = defaultProducts.find(d => d.id === currentId);
    if(!def) return;
    const p = getCurrent();
    Object.assign(p, clone(def));
    syncFormFromCurrent();
    saveState(products);
    setStatus("Reset ✅");
  });

  // init
  renderSelect();
  syncFormFromCurrent();
</script>
</body>
</html>
